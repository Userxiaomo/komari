import{c as Ke,R as C,r as D,u as Fe,v as Ve,f as Ie,j as e,b as ze,d as qe}from"./entry-index-B-fzmtso.js";import{u as Be,a as We}from"./chunk-LiveDataContext-BED_eCku.js";import{p as Pe,l as Ne,F as Je}from"./chunk-PriceTags-BBV80nTf.js";import{a as ue,L as ye,m as je,i as fe,C as Ae,A as Qe,b as me,c as Se,d as Ze,e as Ce,h as et,j as tt,u as at,k as De,G as rt,l as Ee,n as Oe,o as nt,p as it,X as Q,Y as Z,q as st,r as $e,s as te,t as ae,v as re,w as ne,x as we,y as pe,z as ot,B as lt,E as ct,D as ut,F as mt}from"./chunk-DetailsGrid-C9abgkLr.js";import{f as I}from"./chunk-unitHelper-BjgrQHpY.js";import{a as He}from"./chunk-utils-bRKmu4jq.js";import{p as se}from"./chunk-flex-MGzrVjdG.js";import{o as ee}from"./chunk-card-BGBx-kb8.js";import{T as ke}from"./chunk-tips-CXnB5HDr.js";import{D as dt}from"./chunk-react-icons.esm-IORLyq2E.js";import{i as ft}from"./chunk-switch-DMZS-wzt.js";import{o as pt}from"./chunk-button-DEhGMKH8.js";import{p as Me}from"./chunk-base-button-DH9OSHVU.js";import"./chunk-react-vendor-Csw2ODfV.js";import"./chunk-internal-Be4ivmVq.js";import"./chunk-require-react-element-DVojHXYL.js";import"./chunk-index-D_W452Xx.js";import"./chunk-index-BBO7VtY0.js";import"./chunk-box-3B0sA5_Q.js";import"./chunk-badge-NlYxK9Bs.js";import"./chunk-throttle-CmHaeH0s.js";import"./chunk-trending-up-CRp4KBGa.js";import"./chunk-separator-BTxVbICm.js";import"./chunk-icon-button-Bgu4ejrN.js";import"./chunk-dialog-DmkLuhHc.js";import"./chunk-heading-CKQb6e5J.js";import"./chunk-index-B-NU4fG6.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],xt=Ke("eye-off",ht);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],yt=Ke("eye",gt);var bt=["layout","type","stroke","connectNulls","isRange","ref"],jt=["key"],Ge;function he(a){"@babel/helpers - typeof";return he=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},he(a)}function Ue(a,t){if(a==null)return{};var n=vt(a,t),r,o;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);for(o=0;o<d.length;o++)r=d[o],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(a,r)&&(n[r]=a[r])}return n}function vt(a,t){if(a==null)return{};var n={};for(var r in a)if(Object.prototype.hasOwnProperty.call(a,r)){if(t.indexOf(r)>=0)continue;n[r]=a[r]}return n}function ce(){return ce=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(a[r]=n[r])}return a},ce.apply(this,arguments)}function Te(a,t){var n=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable})),n.push.apply(n,r)}return n}function ie(a){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Te(Object(n),!0).forEach(function(r){q(a,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(n)):Te(Object(n)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(n,r))})}return a}function wt(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function Re(a,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,Ye(r.key),r)}}function Nt(a,t,n){return t&&Re(a.prototype,t),n&&Re(a,n),Object.defineProperty(a,"prototype",{writable:!1}),a}function _t(a,t,n){return t=_e(t),At(a,Xe()?Reflect.construct(t,n||[],_e(a).constructor):t.apply(a,n))}function At(a,t){if(t&&(he(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kt(a)}function kt(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Xe(){try{var a=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Xe=function(){return!!a})()}function _e(a){return _e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},_e(a)}function Dt(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(t&&t.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),t&&Le(a,t)}function Le(a,t){return Le=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},Le(a,t)}function q(a,t,n){return t=Ye(t),t in a?Object.defineProperty(a,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[t]=n,a}function Ye(a){var t=Lt(a,"string");return he(t)=="symbol"?t:t+""}function Lt(a,t){if(he(a)!="object"||!a)return a;var n=a[Symbol.toPrimitive];if(n!==void 0){var r=n.call(a,t);if(he(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}var z=function(a){function t(){var n;wt(this,t);for(var r=arguments.length,o=new Array(r),d=0;d<r;d++)o[d]=arguments[d];return n=_t(this,t,[].concat(o)),q(n,"state",{isAnimationFinished:!0}),q(n,"id",at("recharts-area-")),q(n,"handleAnimationEnd",function(){var l=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),De(l)&&l()}),q(n,"handleAnimationStart",function(){var l=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),De(l)&&l()}),n}return Dt(t,a),Nt(t,[{key:"renderDots",value:function(r,o,d){var l=this.props.isAnimationActive,m=this.state.isAnimationFinished;if(l&&!m)return null;var p=this.props,h=p.dot,x=p.points,y=p.dataKey,b=ue(this.props,!1),F=ue(h,!0),j=x.map(function(_,k){var g=ie(ie(ie({key:"dot-".concat(k),r:3},b),F),{},{index:k,cx:_.x,cy:_.y,dataKey:y,value:_.value,payload:_.payload,points:x});return t.renderDotItem(h,g)}),L={clipPath:r?"url(#clipPath-".concat(o?"":"dots-").concat(d,")"):null};return C.createElement(ye,ce({className:"recharts-area-dots"},L),j)}},{key:"renderHorizontalRect",value:function(r){var o=this.props,d=o.baseLine,l=o.points,m=o.strokeWidth,p=l[0].x,h=l[l.length-1].x,x=r*Math.abs(p-h),y=je(l.map(function(b){return b.y||0}));return fe(d)&&typeof d=="number"?y=Math.max(d,y):d&&Array.isArray(d)&&d.length&&(y=Math.max(je(d.map(function(b){return b.y||0})),y)),fe(y)?C.createElement("rect",{x:p<h?p:p-x,y:0,width:x,height:Math.floor(y+(m?parseInt("".concat(m),10):1))}):null}},{key:"renderVerticalRect",value:function(r){var o=this.props,d=o.baseLine,l=o.points,m=o.strokeWidth,p=l[0].y,h=l[l.length-1].y,x=r*Math.abs(p-h),y=je(l.map(function(b){return b.x||0}));return fe(d)&&typeof d=="number"?y=Math.max(d,y):d&&Array.isArray(d)&&d.length&&(y=Math.max(je(d.map(function(b){return b.x||0})),y)),fe(y)?C.createElement("rect",{x:0,y:p<h?p:p-x,width:y+(m?parseInt("".concat(m),10):1),height:Math.floor(x)}):null}},{key:"renderClipRect",value:function(r){var o=this.props.layout;return o==="vertical"?this.renderVerticalRect(r):this.renderHorizontalRect(r)}},{key:"renderAreaStatically",value:function(r,o,d,l){var m=this.props,p=m.layout,h=m.type,x=m.stroke,y=m.connectNulls,b=m.isRange;m.ref;var F=Ue(m,bt);return C.createElement(ye,{clipPath:d?"url(#clipPath-".concat(l,")"):null},C.createElement(Ae,ce({},ue(F,!0),{points:r,connectNulls:y,type:h,baseLine:o,layout:p,stroke:"none",className:"recharts-area-area"})),x!=="none"&&C.createElement(Ae,ce({},ue(this.props,!1),{className:"recharts-area-curve",layout:p,type:h,connectNulls:y,fill:"none",points:r})),x!=="none"&&b&&C.createElement(Ae,ce({},ue(this.props,!1),{className:"recharts-area-curve",layout:p,type:h,connectNulls:y,fill:"none",points:o})))}},{key:"renderAreaWithAnimation",value:function(r,o){var d=this,l=this.props,m=l.points,p=l.baseLine,h=l.isAnimationActive,x=l.animationBegin,y=l.animationDuration,b=l.animationEasing,F=l.animationId,j=this.state,L=j.prevPoints,_=j.prevBaseLine;return C.createElement(Qe,{begin:x,duration:y,isActive:h,easing:b,from:{t:0},to:{t:1},key:"area-".concat(F),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(k){var g=k.t;if(L){var $=L.length/m.length,N=m.map(function(w,K){var U=Math.floor(K*$);if(L[U]){var M=L[U],V=me(M.x,w.x),W=me(M.y,w.y);return ie(ie({},w),{},{x:V(g),y:W(g)})}return w}),A;if(fe(p)&&typeof p=="number"){var f=me(_,p);A=f(g)}else if(Se(p)||Ze(p)){var P=me(_,0);A=P(g)}else A=p.map(function(w,K){var U=Math.floor(K*$);if(_[U]){var M=_[U],V=me(M.x,w.x),W=me(M.y,w.y);return ie(ie({},w),{},{x:V(g),y:W(g)})}return w});return d.renderAreaStatically(N,A,r,o)}return C.createElement(ye,null,C.createElement("defs",null,C.createElement("clipPath",{id:"animationClipPath-".concat(o)},d.renderClipRect(g))),C.createElement(ye,{clipPath:"url(#animationClipPath-".concat(o,")")},d.renderAreaStatically(m,p,r,o)))})}},{key:"renderArea",value:function(r,o){var d=this.props,l=d.points,m=d.baseLine,p=d.isAnimationActive,h=this.state,x=h.prevPoints,y=h.prevBaseLine,b=h.totalLength;return p&&l&&l.length&&(!x&&b>0||!Ce(x,l)||!Ce(y,m))?this.renderAreaWithAnimation(r,o):this.renderAreaStatically(l,m,r,o)}},{key:"render",value:function(){var r,o=this.props,d=o.hide,l=o.dot,m=o.points,p=o.className,h=o.top,x=o.left,y=o.xAxis,b=o.yAxis,F=o.width,j=o.height,L=o.isAnimationActive,_=o.id;if(d||!m||!m.length)return null;var k=this.state.isAnimationFinished,g=m.length===1,$=He("recharts-area",p),N=y&&y.allowDataOverflow,A=b&&b.allowDataOverflow,f=N||A,P=Se(_)?this.id:_,w=(r=ue(l,!1))!==null&&r!==void 0?r:{r:3,strokeWidth:2},K=w.r,U=K===void 0?3:K,M=w.strokeWidth,V=M===void 0?2:M,W=et(l)?l:{},B=W.clipDot,oe=B===void 0?!0:B,X=U*2+V;return C.createElement(ye,{className:$},N||A?C.createElement("defs",null,C.createElement("clipPath",{id:"clipPath-".concat(P)},C.createElement("rect",{x:N?x:x-F/2,y:A?h:h-j/2,width:N?F:F*2,height:A?j:j*2})),!oe&&C.createElement("clipPath",{id:"clipPath-dots-".concat(P)},C.createElement("rect",{x:x-X/2,y:h-X/2,width:F+X,height:j+X}))):null,g?null:this.renderArea(f,P),(l||g)&&this.renderDots(f,oe,P),(!L||k)&&tt.renderCallByParent(this.props,m))}}],[{key:"getDerivedStateFromProps",value:function(r,o){return r.animationId!==o.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,curBaseLine:r.baseLine,prevPoints:o.curPoints,prevBaseLine:o.curBaseLine}:r.points!==o.curPoints||r.baseLine!==o.curBaseLine?{curPoints:r.points,curBaseLine:r.baseLine}:null}}])}(D.PureComponent);Ge=z;q(z,"displayName","Area");q(z,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!rt.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});q(z,"getBaseValue",function(a,t,n,r){var o=a.layout,d=a.baseValue,l=t.props.baseValue,m=l??d;if(fe(m)&&typeof m=="number")return m;var p=o==="horizontal"?r:n,h=p.scale.domain();if(p.type==="number"){var x=Math.max(h[0],h[1]),y=Math.min(h[0],h[1]);return m==="dataMin"?y:m==="dataMax"||x<0?x:Math.max(Math.min(h[0],h[1]),0)}return m==="dataMin"?h[0]:m==="dataMax"?h[1]:h[0]});q(z,"getComposedData",function(a){var t=a.props,n=a.item,r=a.xAxis,o=a.yAxis,d=a.xAxisTicks,l=a.yAxisTicks,m=a.bandSize,p=a.dataKey,h=a.stackedData,x=a.dataStartIndex,y=a.displayedData,b=a.offset,F=t.layout,j=h&&h.length,L=Ge.getBaseValue(t,n,r,o),_=F==="horizontal",k=!1,g=y.map(function(N,A){var f;j?f=h[x+A]:(f=Ee(N,p),Array.isArray(f)?k=!0:f=[L,f]);var P=f[1]==null||j&&Ee(N,p)==null;return _?{x:Oe({axis:r,ticks:d,bandSize:m,entry:N,index:A}),y:P?null:o.scale(f[1]),value:f,payload:N}:{x:P?null:r.scale(f[1]),y:Oe({axis:o,ticks:l,bandSize:m,entry:N,index:A}),value:f,payload:N}}),$;return j||k?$=g.map(function(N){var A=Array.isArray(N.value)?N.value[0]:null;return _?{x:N.x,y:A!=null&&N.y!=null?o.scale(A):null}:{x:A!=null?r.scale(A):null,y:N.y}}):$=_?o.scale(L):r.scale(L),ie({points:g,baseLine:$,layout:F,isRange:k},b)});q(z,"renderDotItem",function(a,t){var n;if(C.isValidElement(a))n=C.cloneElement(a,t);else if(De(a))n=a(t);else{var r=He("recharts-area-dot",typeof a!="boolean"?a.className:""),o=t.key,d=Ue(t,jt);n=C.createElement(nt,ce({},d,{key:o,className:r}))}return n});var ve=it({chartName:"AreaChart",GraphicalChild:z,axisComponents:[{axisType:"xAxis",AxisComp:Q},{axisType:"yAxis",AxisComp:Z}],formatAxisMap:st});const Ft=({data:a=[]})=>{var oe,X,xe,ge,s,u;const{t}=Fe(),{live_data:n}=Be(),{uuid:r}=Ve(),{nodeList:o}=We(),{publicInfo:d}=Ie(),l=(d==null?void 0:d.record_preserve_time)||0,[m,p]=D.useState("real-time"),[h,x]=D.useState(null),[y,b]=D.useState(!1),[F,j]=D.useState(null);D.useEffect(()=>{_.length>0&&p(_[0].label)},[l]);const L=[{label:t("chart.hours",{count:4}),hours:4},{label:t("chart.days",{count:1}),hours:24},{label:t("chart.days",{count:7}),hours:168},{label:t("chart.days",{count:30}),hours:720}],_=[{label:t("common.real_time")}];if(typeof l=="number"&&l>0){for(const c of L)l>=c.hours&&_.push({label:c.label,hours:c.hours});const i=L[L.length-1];l>i.hours?_.push({label:`${t("chart.hours",{count:l})}`,hours:l}):l>4&&!L.some(c=>c.hours===l)&&_.push({label:`${t("chart.hours",{count:l})}`,hours:l})}D.useEffect(()=>{const i=_.find(c=>c.label===m);if(r){if(!i||!i.hours){x(null),j(null),b(!1);return}b(!0),j(null),fetch(`/api/records/load?uuid=${r}&hours=${i.hours}`).then(c=>{if(!c.ok)throw new Error(c.statusText);return c.json()}).then(c=>{var T,H;const v=((T=c.data)==null?void 0:T.records)||[],E=((H=c.data)==null?void 0:H.gpu_devices)||{},O=v.map(G=>{var S;const J=[];for(const Y in E){const R=(S=E[Y].records)==null?void 0:S.find(be=>new Date(be.time).getTime()===new Date(G.time).getTime());R&&J.push({usage:R.utilization,memory:R.mem_used/R.mem_total*100,temperature:R.temperature,device_index:R.device_index,device_name:R.device_name,mem_total:R.mem_total,mem_used:R.mem_used})}return{...G,gpu_detailed:J.length>0?J:void 0}});O.sort((G,J)=>new Date(G.time).getTime()-new Date(J.time).getTime()),x(O),b(!1)}).catch(c=>{j(c.message||"Error"),b(!1)})}},[m,r]);const k=["#F38181","#FCE38A","#EAFFD0","#95E1D3"],g=k[0],$=k[1],N="max-w-72 min-w-72 flex flex-col w-full h-full gap-4",A={top:0,right:16,bottom:0,left:16},f=(oe=n==null?void 0:n.data)==null?void 0:oe.data[r??""],P=(i,c)=>c===0||c===B.length-1?L[0].label===m||m==="real-time"||m===t("common.real_time")?new Date(i).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):new Date(i).toLocaleDateString([],{month:"2-digit",day:"2-digit"}):"",w=o==null?void 0:o.find(i=>i.uuid===r),K=i=>{const c=new Date(i);return m===t("common.real_time")||m==="real-time"?c.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}):c.toLocaleString([],{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},U=i=>`${i.toFixed(2)}%`,M=(i,c)=>e.jsxs(se,{justify:"between",align:"center",className:"mb-2",children:[e.jsx("label",{className:"text-xl font-bold",children:i}),e.jsx("label",{className:"text-sm text-muted-foreground",children:c})]}),V=60,W=V*60,B=m===t("common.real_time")||m==="real-time"?a:m===L[0].label?$e(h??[],V,W*4,V*2):(()=>{var E,O;const i=((E=L.find(T=>T.label===m))==null?void 0:E.hours)||((O=_.find(T=>T.label===m))==null?void 0:O.hours)||24,c=i>120?W:V*15,v=c*2;return $e(h??[],c,W*i,v)})();return e.jsxs(se,{direction:"column",align:"center",gap:"4",className:"w-full max-w-screen",children:[e.jsx("div",{className:"overflow-x-auto w-full flex items-center justify-center",children:e.jsx(Pe,{value:m,onValueChange:p,children:_.map(i=>e.jsx(Ne,{value:i.label,className:"capitalize",children:i.label==="real-time"?t("common.real_time"):i.label},i.label))})}),y&&e.jsx("div",{style:{textAlign:"center",width:"100%"},children:e.jsx(ze,{})}),F&&e.jsx("div",{style:{color:"red",textAlign:"center",width:"100%"},children:F}),e.jsxs("div",{className:"gap-2 grid w-full justify-items-center mx-auto max-w-[900px]",style:{gridTemplateColumns:"repeat(auto-fit, minmax(288px, 1fr))"},children:[e.jsxs(ee,{className:N,children:[M("CPU",(X=f==null?void 0:f.cpu)!=null&&X.usage?`${f.cpu.usage.toFixed(2)}%`:"-"),e.jsx(te,{config:{cpu:{label:"CPU",color:g}},children:e.jsxs(ve,{data:B,accessibilityLayer:!0,margin:A,children:[e.jsx(ae,{vertical:!1}),e.jsx(Q,{dataKey:"time",tickLine:!1,tickFormatter:P,interval:0}),e.jsx(Z,{tickLine:!1,axisLine:!1,domain:[0,100],tickFormatter:(i,c)=>c!==0?`${i}%`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(re,{cursor:!1,formatter:U,content:e.jsx(ne,{labelFormatter:K,indicator:"dot"})}),e.jsx(z,{dataKey:"cpu",animationDuration:0,stroke:g,fill:g,opacity:.8,dot:!1})]})})]}),e.jsxs(ee,{className:N,children:[M("Ram",e.jsxs(se,{gap:"0",direction:"column",align:"end",className:"text-sm",children:[e.jsx("label",{children:(xe=f==null?void 0:f.ram)!=null&&xe.used?`${I(f.ram.used)} / ${I((w==null?void 0:w.mem_total)||0)}`:"-"}),e.jsx("label",{children:(ge=f==null?void 0:f.swap)!=null&&ge.used?`${I(f.swap.used)} / ${I((w==null?void 0:w.swap_total)||0)}`:"-"})]})),e.jsx(te,{config:{ram:{label:"Ram",color:g},swap:{label:"Swap",color:$}},children:e.jsxs(ve,{data:B.map(i=>({time:i.time,ram:(i.ram??0)/((w==null?void 0:w.mem_total)??1)*100,ram_raw:i.ram,swap:(i.swap??0)/((w==null?void 0:w.swap_total)??1)*100,swap_raw:i.swap,client:i.client})),accessibilityLayer:!0,margin:A,children:[e.jsx(ae,{vertical:!1}),e.jsx(Q,{dataKey:"time",tickLine:!1,tickFormatter:P,interval:0}),e.jsx(Z,{tickLine:!1,axisLine:!1,domain:[0,100],tickFormatter:(i,c)=>c!==0?`${i}%`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(re,{cursor:!1,formatter:(i,c,v)=>{const E=(v==null?void 0:v.payload)||{};let O=0;c==="ram"?O=E.ram_raw??0:c==="swap"&&(O=E.swap_raw??0);let T=0;if(typeof i=="number")T=i;else if(typeof i=="string"){const H=parseFloat(i);T=isNaN(H)?0:H}else Array.isArray(i)&&(T=typeof i[0]=="number"?i[0]:parseFloat(i[0]||"0"));return`${I(O)} (${T.toFixed(0)}%)`},content:e.jsx(ne,{labelFormatter:K,indicator:"dot"})}),e.jsx(z,{dataKey:"ram",animationDuration:0,stroke:g,fill:g,opacity:.8,dot:!1}),e.jsx(z,{dataKey:"swap",animationDuration:0,stroke:$,fill:$,opacity:.8,dot:!1})]})})]}),e.jsxs(ee,{className:N,children:[M("Disk",(s=f==null?void 0:f.disk)!=null&&s.used?`${I(f.disk.used)} / ${I((w==null?void 0:w.disk_total)||0)}`:"-"),e.jsx(te,{config:{disk:{label:"Disk",color:g}},children:e.jsxs(ve,{data:B,accessibilityLayer:!0,margin:A,children:[e.jsx(ae,{vertical:!1}),e.jsx(Q,{dataKey:"time",tickLine:!1,tickFormatter:P,interval:0}),e.jsx(Z,{tickLine:!1,axisLine:!1,domain:[0,(w==null?void 0:w.disk_total)||100],tickFormatter:(i,c)=>c!==0?`${I(i)}`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(re,{cursor:!1,formatter:I,content:e.jsx(ne,{labelFormatter:K,indicator:"dot"})}),e.jsx(z,{dataKey:"disk",animationDuration:0,stroke:g,fill:g,opacity:.8,dot:!1})]})})]}),e.jsxs(ee,{className:N,children:[M(t("nodeCard.networkSpeed"),e.jsxs(se,{gap:"0",align:"end",direction:"column",className:"text-sm",children:[e.jsxs("span",{children:["↑ ",I((f==null?void 0:f.network.up)||0),"/s"]}),e.jsxs("span",{children:["↓ ",I((f==null?void 0:f.network.down)||0),"/s"]})]})),e.jsx(te,{config:{net_in:{label:t("chart.network_down"),color:g},net_out:{label:t("chart.network_up"),color:k[3]}},children:e.jsxs(we,{data:B,accessibilityLayer:!0,margin:A,children:[e.jsx(ae,{vertical:!1}),e.jsx(Q,{dataKey:"time",tickLine:!1,tickFormatter:P,interval:0}),e.jsx(Z,{tickLine:!1,axisLine:!1,tickFormatter:(i,c)=>c!==0?`${I(i)}`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(re,{cursor:!1,formatter:I,content:e.jsx(ne,{labelFormatter:K,indicator:"dot"})}),e.jsx(pe,{dataKey:"net_in",animationDuration:0,stroke:g,fill:g,opacity:.8,dot:!1}),e.jsx(pe,{dataKey:"net_out",animationDuration:0,stroke:k[3],fill:k[3],opacity:.8,dot:!1})]})})]}),e.jsxs(ee,{className:N,children:[M(t("chart.connections"),e.jsxs(se,{gap:"0",align:"end",direction:"column",className:"text-sm",children:[e.jsxs("span",{children:["TCP: ",f==null?void 0:f.connections.tcp]}),e.jsxs("span",{children:["UDP: ",f==null?void 0:f.connections.udp]})]})),e.jsx(te,{config:{connections:{label:"TCP",color:g},connections_udp:{label:"UDP",color:k[3]}},children:e.jsxs(we,{data:B,accessibilityLayer:!0,margin:A,children:[e.jsx(ae,{vertical:!1}),e.jsx(Q,{dataKey:"time",tickLine:!1,tickFormatter:P,interval:0}),e.jsx(Z,{tickLine:!1,axisLine:!1,tickFormatter:(i,c)=>c!==0?`${i}`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(re,{cursor:!1,content:e.jsx(ne,{labelFormatter:K,indicator:"dot"})}),e.jsx(pe,{dataKey:"connections",animationDuration:0,stroke:g,fill:g,opacity:.8,dot:!1}),e.jsx(pe,{dataKey:"connections_udp",animationDuration:0,stroke:k[3],fill:k[3],opacity:.8,dot:!1})]})})]}),e.jsxs(ee,{className:N,children:[M(t("chart.process"),f==null?void 0:f.process),e.jsx(te,{config:{process:{label:t("chart.process"),color:g}},children:e.jsxs(we,{data:B,accessibilityLayer:!0,margin:A,children:[e.jsx(ae,{vertical:!1}),e.jsx(Q,{dataKey:"time",tickLine:!1,tickFormatter:P,interval:0}),e.jsx(Z,{tickLine:!1,axisLine:!1,domain:[0,100],tickFormatter:(i,c)=>c!==0?`${i}`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(re,{cursor:!1,content:e.jsx(ne,{labelFormatter:K,indicator:"dot"})}),e.jsx(pe,{dataKey:"process",animationDuration:0,stroke:g,fill:g,opacity:.8,dot:!1})]})})]}),(f==null?void 0:f.gpu)&&f.gpu.count>0&&((u=f.gpu.detailed_info)==null?void 0:u.map((i,c)=>e.jsxs(ee,{className:N,children:[e.jsxs(se,{direction:"column",gap:"2",className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-xl font-bold",children:`GPU ${c+1}: ${i.name}`}),e.jsx("span",{className:"text-sm text-muted-foreground",children:I(i.memory_total)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:t("chart.usage")}),e.jsxs("div",{className:"text-lg font-bold text-foreground",children:[i.utilization,"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:t("chart.gpu_memory")}),e.jsxs("div",{className:"text-lg font-bold text-foreground",children:[(i.memory_used/i.memory_total*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:t("nodeCard.temperature")}),e.jsxs("div",{className:"text-lg font-bold text-foreground",children:[i.temperature,"°C"]})]})]})]}),e.jsx(te,{config:{gpu_usage:{label:"GPU",color:g},gpu_memory:{label:t("chart.gpu_memory"),color:$},gpu_temp:{label:t("nodeCard.temperature"),color:k[2]}},children:e.jsxs(ve,{data:B.map(v=>{var E,O,T,H,G,J,S,Y,le,R;return{time:v.time,gpu_usage:((O=(E=v.gpu_detailed)==null?void 0:E[c])==null?void 0:O.usage)??v.gpu_usage??0,gpu_memory:((H=(T=v.gpu_detailed)==null?void 0:T[c])==null?void 0:H.memory)??v.gpu_memory??0,gpu_memory_raw:((J=(G=v.gpu_detailed)==null?void 0:G[c])==null?void 0:J.mem_used)??i.memory_total*(((Y=(S=v.gpu_detailed)==null?void 0:S[c])==null?void 0:Y.memory)||0)/100,gpu_temp:((R=(le=v.gpu_detailed)==null?void 0:le[c])==null?void 0:R.temperature)??0,client:v.client}}),accessibilityLayer:!0,margin:A,children:[e.jsx(ae,{vertical:!1}),e.jsx(Q,{dataKey:"time",tickLine:!1,tickFormatter:P,interval:0}),e.jsx(Z,{tickLine:!1,axisLine:!1,domain:[0,100],tickFormatter:(v,E)=>E!==0?`${v}%`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(re,{cursor:!1,formatter:(v,E,O)=>{var T;if(E==="gpu_temp")return`${v}°C`;if(E==="gpu_usage")return`${Number(v).toFixed(1)}%`;if(E==="gpu_memory"){const H=Number(v).toFixed(1),G=((T=O.payload)==null?void 0:T.gpu_memory_raw)||0;return`${I(G)}(${H}%)`}return`${Number(v).toFixed(1)}`},content:e.jsx(ne,{labelFormatter:K,indicator:"dot"})}),e.jsx(z,{dataKey:"gpu_usage",animationDuration:0,stroke:g,fill:g,opacity:.8,dot:!1}),e.jsx(z,{dataKey:"gpu_memory",animationDuration:0,stroke:$,fill:$,opacity:.8,dot:!1}),e.jsx(z,{dataKey:"gpu_temp",animationDuration:0,stroke:k[2],fill:k[2],opacity:.6,dot:!1})]})})]},`gpu-${c}`)))]})]})},de=["#F38181","#347433","#898AC4","#03A6A1","#7AD6F0","#B388FF","#FF8A65","#FFD600"],Pt=({uuid:a})=>{var X,xe,ge;const{t}=Fe(),{publicInfo:n}=Ie(),{call:r}=qe(),o=(n==null?void 0:n.ping_record_preserve_time)||0,d=[{label:t("chart.hours",{count:1}),hours:1},{label:t("chart.hours",{count:6}),hours:6},{label:t("chart.hours",{count:12}),hours:12},{label:t("chart.days",{count:1}),hours:24}],l=[];if(typeof o=="number"&&o>0){for(const u of d)o>=u.hours&&l.push({label:u.label,hours:u.hours});const s=d[d.length-1];o>s.hours?l.push({label:`${t("chart.hours",{count:o})}`,hours:o}):o>1&&!d.some(u=>u.hours===o)&&l.push({label:`${t("chart.hours",{count:o})}`,hours:o})}const m=((X=l.find(s=>s.hours===1))==null?void 0:X.label)||((xe=l[0])==null?void 0:xe.label)||"",[p,h]=D.useState(m),[x,y]=D.useState(((ge=l.find(s=>s.label===m))==null?void 0:ge.hours)||1),[b,F]=D.useState(null),[j,L]=D.useState([]),[_,k]=D.useState(!1),[g,$]=D.useState(null),[N,A]=D.useState(!1);D.useEffect(()=>{const s=l.find(u=>u.label===p);s&&s.hours!==void 0&&y(s.hours)},[p,l]),D.useEffect(()=>{if(!a)return;if(!x){F(null),$(null),k(!1);return}k(!0),$(null);const s=new AbortController;return(async()=>{try{const u=await r("common:getRecords",{uuid:a,type:"ping",hours:x}),i=(u==null?void 0:u.records)||[];i.sort((c,v)=>new Date(c.time).getTime()-new Date(v.time).getTime()),F(i),L((u==null?void 0:u.tasks)||[]),k(!1)}catch(u){$((u==null?void 0:u.message)||"Error"),k(!1)}})(),()=>s.abort()},[x,a]);const f=D.useMemo(()=>{const s=b||[];if(!s.length)return[];const u=j.map(S=>S.interval).filter(S=>typeof S=="number"&&S>0),i=u.length?Math.min(...u):60,c=Math.min(6e3,Math.max(800,Math.floor(i*1e3*.25))),v={},E=[];for(const S of s){const Y=new Date(S.time).getTime();let le=null;for(const be of E)if(Math.abs(be-Y)<=c){le=be;break}const R=le??Y;v[R]||(v[R]={time:new Date(R).toISOString()},le===null&&E.push(R)),v[R][S.task_id]=S.value<0?null:S.value}const O=Object.values(v).sort((S,Y)=>new Date(S.time).getTime()-new Date(Y.time).getTime()),H=new Date(O[O.length-1].time).getTime()-x*36e5;let G=0;for(let S=0;S<O.length;S++)if(new Date(O[S].time).getTime()>=H){G=Math.max(0,S-1);break}return O.slice(G)},[b,j,x]),P=D.useMemo(()=>{let s=f;if(N&&j.length>0){const u=j.map(i=>String(i.id));s=ot(f,u)}if(j.length>0&&s.length>0){const u=j.map(i=>String(i.id));s=lt(s,u,{maxGapMultiplier:6,minCapMs:2*6e4,maxCapMs:30*6e4})}return s},[b,N,j,x]),w=(s,u)=>P.length&&(u===0||u===P.length-1)?x<24?new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):new Date(s).toLocaleDateString([],{month:"2-digit",day:"2-digit"}):"",K=s=>{const u=new Date(s);return x<24?u.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}):u.toLocaleString([],{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},U=D.useMemo(()=>{const s={};return j.forEach((u,i)=>{s[u.id]={label:`${u.name}${typeof u.p99_p50_ratio=="number"?` (${t("chart.volatility")}: ${u.p99_p50_ratio.toFixed(2)})`:""}`,color:de[i%de.length]}}),s},[j]),M=D.useMemo(()=>{if(!b||!j.length)return[];const s=new Map;for(const u of j)for(let i=b.length-1;i>=0;i--){const c=b[i];if(c.task_id===u.id&&c.value>=0){s.set(u.id,c);break}}return j.map((u,i)=>{var c,v;return{...u,value:((c=s.get(u.id))==null?void 0:c.value)??null,time:((v=s.get(u.id))==null?void 0:v.time)??null,color:de[i%de.length]}})},[b,j]),[V,W]=D.useState({}),B=D.useCallback(s=>{const u=s.dataKey;W(i=>({...i,[u]:!i[u]}))},[]),oe=D.useCallback(()=>{const s=j.every(i=>V[String(i.id)]),u={};j.forEach(i=>{u[String(i.id)]=!s}),W(u)},[j,V]);return e.jsxs(se,{direction:"column",align:"center",gap:"4",className:"w-full max-w-screen",children:[e.jsx("div",{className:"overflow-x-auto w-full flex items-center justify-center",children:e.jsx(Pe,{value:p,onValueChange:s=>{h(s);const u=l.find(i=>i.label===s);u&&u.hours!==void 0&&y(u.hours)},children:l.map(s=>e.jsx(Ne,{value:s.label,className:"capitalize",children:s.label},s.label))})}),_&&e.jsx("div",{style:{textAlign:"center",width:"100%"},children:e.jsx(ze,{})}),g&&e.jsx("div",{style:{color:"red",textAlign:"center",width:"100%"},children:g}),M.length>0?e.jsxs(ee,{className:"w-full max-w-[900px] mb-2",children:[e.jsx(ke,{className:"absolute top-0 right-0 m-2",children:e.jsx("label",{children:t("chart.loss_tips")})}),e.jsx("div",{className:"grid gap-2 mb-2 w-full",style:{gridTemplateColumns:"repeat(auto-fit, minmax(240px,1fr))"},children:M.map(s=>e.jsxs("div",{className:"flex flex-row items-center rounded",children:[e.jsx("div",{className:"w-1 h-6 rounded-xs ",style:{backgroundColor:s.color}}),e.jsxs("div",{className:"flex items-start justify-center ml-1 flex-col",children:[e.jsxs("div",{className:"flex items-center gap-1 -mb-1",children:[e.jsx("label",{className:"font-bold text-md",children:s.name}),e.jsx(ke,{side:"top",trigger:e.jsx(dt,{className:"cursor-pointer",color:"gray"}),children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1",children:[typeof s.min=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.min")}),e.jsxs("span",{className:"font-mono",children:[Math.round(s.min)," ms"]})]}),typeof s.max=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.max")}),e.jsxs("span",{className:"font-mono",children:[Math.round(s.max)," ms"]})]}),typeof s.avg=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.avg")}),e.jsxs("span",{className:"font-mono",children:[Math.round(s.avg)," ms"]})]}),typeof s.latest=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.latest")}),e.jsxs("span",{className:"font-mono",children:[Math.round(s.latest)," ms"]})]}),typeof s.p99_p50_ratio=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.volatility")}),e.jsx("span",{className:"font-mono",children:s.p99_p50_ratio.toFixed(2)})]}),typeof s.p50=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:"p50"}),e.jsxs("span",{className:"font-mono",children:[Math.round(s.p50)," ms"]})]}),typeof s.p99=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:"p99"}),e.jsxs("span",{className:"font-mono",children:[Math.round(s.p99)," ms"]})]}),typeof s.loss=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.lossRate")}),e.jsxs("span",{className:"font-mono",children:[Number(s.loss).toFixed(1),"%"]})]}),typeof s.interval=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.interval")}),e.jsxs("span",{className:"font-mono",children:[s.interval,"s"]})]}),s.type&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.type")}),e.jsx("span",{className:"font-mono uppercase",children:s.type})]}),typeof s.total=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.total")}),e.jsx("span",{className:"font-mono",children:s.total})]})]})})]}),e.jsxs("div",{className:"flex gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:s.value!==null?`${Number(s.value).toFixed(0)} ms`:"-"}),e.jsx("span",{children:`${Number(s.loss).toFixed(1)}%${t("chart.lossRate")}`}),typeof s.p99_p50_ratio=="number"&&e.jsxs("span",{title:"p99/p50",children:[s.p99_p50_ratio.toFixed(1),t("chart.volatility")]})]})]})]},s.id))})]}):e.jsx("div",{className:"w-full max-w-[900px] text-center text-muted-foreground mb-2",children:t("common.none")}),e.jsxs(ee,{className:"w-full max-w-[900px]",children:[P.length===0?e.jsx("div",{className:"w-full h-40 flex items-center justify-center text-muted-foreground",children:t("common.none")}):e.jsx(te,{config:U,children:e.jsxs(we,{data:P,accessibilityLayer:!0,margin:{top:0,right:16,bottom:0,left:16},children:[e.jsx(ae,{vertical:!1}),e.jsx(Q,{dataKey:"time",tickLine:!1,tickFormatter:w,interval:"preserveStartEnd",minTickGap:30,allowDuplicatedCategory:!1}),e.jsx(Z,{tickLine:!1,axisLine:!1,unit:"ms",allowDecimals:!1,orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(re,{cursor:!1,formatter:s=>`${Math.round(s)} ms`,content:e.jsx(ne,{labelFormatter:K,indicator:"dot"})}),e.jsx(ct,{onClick:B}),j.map((s,u)=>e.jsx(pe,{dataKey:String(s.id),name:s.name,stroke:de[u%de.length],dot:!1,isAnimationActive:!1,strokeWidth:2,connectNulls:!1,type:N?"basis":"linear",hide:!!V[String(s.id)]},s.id))]})}),e.jsxs("div",{className:"flex items-center justify-between gap-4",style:{display:_?"none":"flex"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{id:"cut-peak",checked:N,onCheckedChange:A}),e.jsxs("label",{htmlFor:"cut-peak",className:"text-sm font-medium flex items-center gap-1 flex-row",children:[t("chart.cutPeak"),e.jsx(ke,{children:e.jsx("span",{dangerouslySetInnerHTML:{__html:t("chart.cutPeak_tips")}})})]})]}),e.jsx(pt,{variant:"soft",size:"2",onClick:oe,className:"flex items-center gap-2",children:j.every(s=>V[String(s.id)])?e.jsxs(e.Fragment,{children:[e.jsx(yt,{size:16}),t("chart.showAll")]}):e.jsxs(e.Fragment,{children:[e.jsx(xt,{size:16}),t("chart.hideAll")]})})]})]})]})};function na(){const{t:a}=Fe(),{onRefresh:t}=Be(),{uuid:n}=Ve(),[r,o]=D.useState([]),{nodeList:d}=We(),[l,m]=D.useState("load"),p=d==null?void 0:d.find(h=>h.uuid===n);return D.useEffect(()=>{fetch(`/api/recent/${n}`).then(h=>h.json()).then(h=>o(h.data.slice(-300))).catch(h=>console.error("Failed to fetch recent data:",h))},[n]),D.useEffect(()=>t(x=>{if(!n)return;const y=x.data.data[n];y&&o(b=>{const F=y;return b.some(_=>_.updated_at===F.updated_at)?b:[...b,F].slice(-300)})}),[t,n]),e.jsxs(se,{className:"items-center",direction:"column",gap:"2",children:[e.jsxs("div",{className:"flex flex-col gap-1 md:p-4 p-3 border-0 rounded-md",children:[e.jsxs("h1",{className:"flex items-center flex-wrap",children:[e.jsx(Je,{flag:(p==null?void 0:p.region)??""}),e.jsx(Me,{size:"3",weight:"bold",wrap:"nowrap",children:(p==null?void 0:p.name)??n}),e.jsx(Me,{size:"1",style:{marginLeft:"8px"},className:"text-accent-6",wrap:"nowrap",children:p==null?void 0:p.uuid})]}),e.jsx(ut,{box:!0,align:"center",uuid:n??""})]}),e.jsxs(Pe,{radius:"full",value:l,onValueChange:h=>m(h),children:[e.jsx(Ne,{value:"load",children:a("nodeCard.load")}),e.jsx(Ne,{value:"ping",children:a("nodeCard.ping")})]}),l==="load"?e.jsx(Ft,{data:mt(n??"",r)}):e.jsx(Pt,{uuid:n??""}),e.jsx("div",{className:"grid w-full items-center justify-center mx-auto h-full gap-4 p-1 md:grid-cols-[repeat(auto-fit,minmax(620px,1fr))] grid-cols-[repeat(auto-fit,minmax(320px,1fr))]"})]})}export{na as default};
