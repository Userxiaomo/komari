import{u as R,r as f,j as e,b as U,t as n}from"./entry-index-B-fzmtso.js";import{u as P,a as d}from"./chunk-api-iyIgA2Lz.js";import{d as v,c as S,e as w,S as b,a as z,f as B,g as V}from"./chunk-SettingCard-Jn5uUOv3.js";import{U as N}from"./chunk-UploadDialog-Dc9afAsf.js";import{D as I}from"./chunk-download-vDQkU54R.js";import{p as X}from"./chunk-base-button-DH9OSHVU.js";import{p as h}from"./chunk-flex-MGzrVjdG.js";import{s as $,n as C,p as M,g as W,m as q,D as H}from"./chunk-dialog-DmkLuhHc.js";import{o as x}from"./chunk-button-DEhGMKH8.js";import"./chunk-react-vendor-Csw2ODfV.js";import"./chunk-text-area-BDJYKPt5.js";import"./chunk-dropdown-menu-CbliYoMA.js";import"./chunk-icons-VdLkFx5D.js";import"./chunk-require-react-element-DVojHXYL.js";import"./chunk-index-BBO7VtY0.js";import"./chunk-index-D_W452Xx.js";import"./chunk-icon-button-Bgu4ejrN.js";import"./chunk-switch-DMZS-wzt.js";import"./chunk-index-B-NU4fG6.js";import"./chunk-text-field-BEd1A3G3.js";import"./chunk-internal-Be4ivmVq.js";import"./chunk-proxy-Dyr7ArBS.js";import"./chunk-chevron-down-DWbbmXVQ.js";import"./chunk-index-Bm_BBTjY.js";import"./chunk-box-3B0sA5_Q.js";import"./chunk-card-BGBx-kb8.js";import"./chunk-heading-CKQb6e5J.js";function vt(){const{t}=R(),{settings:r,loading:F,error:k}=P(),[T,j]=f.useState(!1),[O,u]=f.useState(!1),[E,l]=f.useState(0),[y,m]=f.useState(null),L=async s=>{if(!s.name.endsWith(".zip")){n.error(t("theme.invalid_file_type","仅支持 .zip 文件"));return}u(!0),l(0);const g=new FormData;return g.append("backup",s),new Promise((_,a)=>{const i=new XMLHttpRequest;m(i),i.upload.addEventListener("progress",o=>{if(o.lengthComputable){const c=o.loaded/o.total*100;l(Math.round(c))}}),i.addEventListener("load",()=>{try{const o=i.status>=200&&i.status<300,c=i.responseText?JSON.parse(i.responseText):{};if(o)if(c&&c.status&&c.status!=="success"){const p=c.message||t("settings.site.backup_restore_error","恢复备份失败");n.error(p),a(new Error(p))}else n.success(t("account_settings.upload_success","上传成功")),j(!1),l(0),_();else{const p=c&&c.message||t("settings.site.backup_restore_error","恢复备份失败");n.error(p),a(new Error(p))}}catch(o){n.error(t("settings.site.backup_restore_error","恢复备份失败")),a(o)}finally{u(!1),m(null)}}),i.addEventListener("error",()=>{n.error(t("settings.site.backup_restore_error","恢复备份失败")),u(!1),l(0),m(null),a(new Error("Network error"))}),i.addEventListener("abort",()=>{n.error(t("theme.upload_failed","上传失败")+": Upload cancelled"),u(!1),l(0),m(null),a(new Error("Upload cancelled"))}),i.open("POST","/api/admin/upload/backup"),i.send(g)})},D=()=>{y&&y.abort()};return F?e.jsx(U,{}):k?e.jsx(X,{color:"red",children:k}):e.jsxs(e.Fragment,{children:[e.jsx(v,{children:t("settings.site.title")}),e.jsx(S,{title:t("settings.site.name"),description:t("settings.site.name_description"),defaultValue:r.sitename||"",OnSave:async s=>{await d({sitename:s},t)}}),e.jsx(w,{title:t("settings.site.description"),description:t("settings.site.description_description"),defaultValue:r.description||"",OnSave:async s=>{await d({description:s},t)}}),e.jsx(b,{title:t("settings.site.cros"),description:t("settings.site.cros_description"),defaultChecked:r.allow_cors,onChange:async s=>{await d({allow_cors:s},t)}}),e.jsx(b,{title:t("settings.site.private_site"),description:t("settings.site.private_site_description"),defaultChecked:r.private_site,onChange:async s=>{await d({private_site:s},t)}}),e.jsx(b,{title:t("settings.site.send_ip_addr_to_guest"),description:t("settings.site.send_ip_addr_to_guest_description"),defaultChecked:r.send_ip_addr_to_guest,onChange:async s=>{await d({send_ip_addr_to_guest:s},t)}}),e.jsx(S,{title:t("settings.site.script_domain"),description:t("settings.site.script_domain_description"),placeholder:`${window.location.origin}`,defaultValue:r.script_domain||"",OnSave:async s=>{await d({script_domain:s},t)}}),e.jsx(v,{children:t("settings.site.custom")}),e.jsx("label",{className:"text-sm text-muted-foreground -mt-4",children:t("settings.custom.note")}),e.jsx(w,{title:t("settings.custom.header"),description:t("settings.custom.header_description"),defaultValue:r.custom_head||"",OnSave:async s=>{await d({custom_head:s},t)}}),e.jsx(w,{title:t("settings.custom.body","自定义 Body"),description:t("settings.custom.body_description","在页面底部添加自定义内容"),defaultValue:r.custom_body||"",OnSave:async s=>{await d({custom_body:s},t)}}),e.jsx(z,{title:t("settings.custom.favicon","自定义 Favicon"),description:t("settings.custom.favicon_description","在浏览器标签页显示的图标"),defaultOpen:!0,children:e.jsxs(h,{width:"100%",justify:"between",align:"start",direction:"column",gap:"2",children:[e.jsxs(h,{gap:"2",align:"center",children:[t("settings.custom.favicon_current","当前 Favicon"),e.jsx("img",{src:"/favicon.ico",alt:"Favicon",style:{width:32,height:32}})]}),e.jsx("label",{className:"text-sm text-muted-foreground",children:t("settings.custom.favicon_note","Favicon 图标的更新速度可能较慢，通常需要清除浏览器缓存后才能看到更改。")}),e.jsxs(h,{gap:"2",align:"center",children:[e.jsxs($,{children:[e.jsx(C,{children:e.jsx(x,{color:"tomato",children:t("settings.custom.favicon_default","恢复默认")})}),e.jsxs(M,{children:[e.jsx(W,{children:t("settings.custom.favicon_default","恢复默认")}),e.jsx(q,{children:t("settings.custom.favicon_default_description","这将恢复默认的 Favicon 图标，是否继续？")}),e.jsxs(h,{gap:"2",justify:"end",children:[e.jsx(H,{children:e.jsx(x,{variant:"soft",children:t("common.cancel","取消")})}),e.jsx(C,{children:e.jsx(x,{color:"red",onClick:async()=>{fetch("/api/admin/update/favicon",{method:"POST"}).then(s=>s.json()).then(s=>{s.status==="success"?n.success(t("settings.custom.favicon_default_success","已恢复默认 Favicon")):n.error(s.message||"恢复默认 Favicon 失败")}).catch(s=>{n.error(""+s)})},children:t("settings.custom.favicon_confirm","确认")})})]})]})]}),e.jsx(x,{onClick:async()=>{const s=document.createElement("input");s.type="file",s.accept="image/*",s.onchange=async g=>{var a;const _=(a=g.target.files)==null?void 0:a[0];if(_)try{const o=await(await fetch("/api/admin/update/favicon",{method:"PUT",body:_,headers:{"Content-Type":"application/octet-stream"}})).json();o.status==="success"?n.success(t("settings.custom.favicon_update_success","已更新 Favicon")):n.error(o.message||"Failed to update Favicon")}catch(i){n.error(""+i)}},s.click()},children:t("settings.custom.favicon_change","更新 Favicon")})]})]})}),e.jsx(v,{children:t("settings.site.backup")}),e.jsx(B,{title:t("settings.site.backup_download"),description:t("settings.site.backup_download_description"),onClick:()=>{window.open("/api/admin/download/backup","_blank")},children:e.jsx(I,{size:16})}),e.jsx(V,{title:t("settings.site.backup_restore"),description:t("settings.site.backup_restore_description"),onClick:()=>j(!0),children:t("common.select")}),e.jsx(N,{open:T,onOpenChange:j,title:t("settings.site.backup_restore"),description:t("settings.site.backup_restore_description"),accept:".zip",dragDropText:t("theme.drag_drop"),clickToBrowseText:t("theme.or_click_to_browse"),hintText:t("theme.zip_files_only"),uploading:O,progress:E,cancelUploadLabel:t("common.cancel"),onCancelUpload:D,onFileSelected:s=>L(s),closeLabel:t("common.cancel")})]})}export{vt as default};
