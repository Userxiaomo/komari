import{R as r,d as L,j as x,r as c}from"./entry-index-B-fzmtso.js";const C=r.createContext(void 0),j=({children:s})=>{const[f,n]=r.useState(null),[m,l]=r.useState(!1),[d,u]=r.useState(null),{call:v}=L(),p=()=>{l(!0),u(null),v("common:getNodes").then(a=>{if(!a||typeof a!="object"){n([]);return}const i=Object.values(a).map(t=>({uuid:t.uuid,name:t.name,cpu_name:t.cpu_name,virtualization:t.virtualization,arch:t.arch,cpu_cores:t.cpu_cores,os:t.os,kernel_version:t.kernel_version,gpu_name:t.gpu_name,region:t.region,mem_total:t.mem_total,swap_total:t.swap_total,disk_total:t.disk_total,version:t.version??"",weight:t.weight??0,price:t.price??0,tags:t.tags??"",billing_cycle:t.billing_cycle??0,currency:t.currency??"",group:t.group??"",traffic_limit:t.traffic_limit??0,traffic_limit_type:t.traffic_limit_type,expired_at:t.expired_at??"",created_at:t.created_at??"",updated_at:t.updated_at??"",ipv4:t.ipv4,ipv6:t.ipv6}));n(i)}).catch(a=>{u((a==null?void 0:a.message)||"An error occurred while fetching data"),n([])}).finally(()=>{l(!1)})};return r.useEffect(()=>{p()},[]),x.jsx(C.Provider,{value:{nodeList:f,isLoading:m,error:d,refresh:p},children:s})},R=()=>{const s=r.useContext(C);if(!s)throw new Error("useNodeList must be used within a NodeListProvider");return s},y=c.createContext({live_data:null,showCallout:!0,onRefresh:()=>{}}),E=({children:s})=>{const[f,n]=c.useState(null),[m,l]=c.useState(!1),[d]=c.useState(new Set),{call:u}=L(),v=a=>{d.add(a)},p=a=>{d.forEach(i=>i(a))};return c.useEffect(()=>{let a,i=!1,t=!1;const b=2e3,g=async()=>{if(!t){t=!0;try{const _=await u("common:getNodesLatestStatus"),k=Object.values(_).filter(o=>o==null?void 0:o.online).map(o=>o.client),w={};for(const[o,N]of Object.entries(_)){const e=N;w[o]={cpu:{usage:typeof e.cpu=="number"?e.cpu:0},ram:{used:e.ram??0},swap:{used:e.swap??0},load:{load1:e.load??0,load5:e.load5??0,load15:e.load15??0},disk:{used:e.disk??0},network:{up:e.net_out??0,down:e.net_in??0,totalUp:e.net_total_out??e.net_total_up??0,totalDown:e.net_total_in??e.net_total_down??0},connections:{tcp:e.connections??0,udp:e.connections_udp??0},gpu:e.gpu!==void 0?{count:0,average_usage:e.gpu,detailed_info:[]}:void 0,uptime:e.uptime??0,process:e.process??0,message:"",updated_at:e.time??0}}const h={data:{online:k,data:w},status:"ok"};n(h),l(!0),p(h)}catch(_){console.error("RPC2 获取最新状态失败:",_),l(!1)}finally{t=!1,i||(a=window.setTimeout(g,b))}}};return g(),()=>{i=!0,a&&window.clearTimeout(a)}},[u]),x.jsx(y.Provider,{value:{live_data:f,showCallout:m,onRefresh:v},children:s})},P=()=>c.useContext(y);export{E as L,j as N,R as a,P as u};
